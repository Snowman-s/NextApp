(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[578],{3964:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/utils/kaladesh-lang",function(){return r(9760)}])},9760:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return E}});var n=r(5893),a=r(9008),i=r.n(a),o=r(1749),d=r(9659),c=r(282),s=r(9895),l=r(7812),m=r(7294),u=r(460),h=r.n(u),f=r(5660),p=r.n(f),b=r(6522);let x={Push:"Push",Dup:"Dup",Copy:"Copy",Swap:"Swap",Discard:"Discard",Slide:"Slide",Add:"Add",Subtract:"Subtract",Multiply:"Multiply",Divide:"Divide",Modulo:"Modulo",KaladeshArithmetic:"KaladeshArithmetic",Store:"Store",Retrieve:"Retrieve",Label:"Label",Call:"Call",Jump:"Jump",JumpIfZero:"JumpIfZero",JumpIfNegative:"JumpIfNegative",Return:"Return",End:"End",OutputCharacter:"OutputCharacter",OutputNumber:"OutputNumber",ReadCharacter:"ReadCharacter",ReadNumber:"ReadNumber"},w=[x.Push,x.Copy,x.Slide],g=[x.Label,x.Call,x.Jump,x.JumpIfNegative,x.JumpIfZero];function k(e){return void 0!=g.find(t=>t==e)}class C{parse(e,t,r,n){let a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],i=this.lexical(e,[t,r,n],a);if(!a){let o=i.map((e,t)=>({error:{msg:'"'.concat(e.where,'" is invalid token'),tokenIndex:t},token:e})).filter(e=>e.token.error).map(e=>e.error);if(o.length>0)return o}let d=i.map(e=>e.where),c=this.transcript(d,t,r,n);return this.syntactic(c)}lexical(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=[],a="",i="",o=e=>{r&&e.error||n.push(e)};e:for(let d of e){if(d.match(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g)){""!=(i+=a)&&o({error:!0,where:i}),i=a="";continue}let c=a;for(let s of(a+=d,t)){if(s==a){""!=i&&o({error:!0,where:i}),i="",o({error:!1,where:a}),a="";continue e}if(a==s.slice(0,a.length))continue e}for(let l of t)if(l[0]==d){i+=c,a=d;continue e}i+=a,a=""}return""!=(i+=a)&&o({error:!0,where:i}),n}transcript(e,t,r,n){let a=e.map(e=>{switch(e){case t:return"ws";case r:return"tab";case n:return"lf";default:throw Error()}});return a}syntactic(e){let t=()=>{let t=e.shift();if(void 0==t)throw new v;return t},r=[],n=[],a=[];try{for(;e.length>0;){let i;let o=this.findIMP(t);switch(o){case"Stack":i=this.findStackCommand(t);break;case"Arith":i=this.findArithCommand(t);break;case"Flow":i=this.findFlowCommand(t);break;case"Heap":i=this.findHeapCommand(t);break;case"IO":i=this.findIOCommand(t)}"msg"in i?(r.push(void 0),a.push(Object.assign(i,{commandIndex:r.length-1}))):(r.push(i),"Label"==i.command&&n.push({label:i.param,commandIndex:r.length-1}))}}catch(d){if(d instanceof v)return{error:[{msg:"Unexpected EOF",commandIndex:r.length}],out:r}}{let c=[];n.forEach(e=>{-1!=c.indexOf(e.label)?a.push({msg:'Label "'.concat(e.label,'" is already exsist.'),commandIndex:e.commandIndex}):c.push(e.label)})}return(r.forEach((e,t)=>{void 0!=e&&k(e.command)&&-1==n.map(e=>e.label).findIndex(t=>t==e.param)&&a.push({msg:'Label "'.concat(e.param,'" is not defined'),commandIndex:t})}),a.length>0)?{error:a.sort((e,t)=>e.commandIndex-t.commandIndex),out:r}:{commands:r,labels:n}}findIMP(e){let t=e();if("ws"==t)return"Stack";if("tab"!=t)return"Flow";{let r=e();return"ws"==r?"Arith":"tab"==r?"Heap":"IO"}}findStackCommand(e){return this.findCommandAndParam(e,[{t:["ws"],cmd:x.Push},{t:["lf","ws"],cmd:x.Dup},{t:["tab","ws"],cmd:x.Copy},{t:["lf","tab"],cmd:x.Swap},{t:["lf","lf"],cmd:x.Discard},{t:["tab","lf"],cmd:x.Slide}])}findArithCommand(e){return this.findCommandAndParam(e,[{t:["ws","ws"],cmd:x.Add},{t:["ws","tab"],cmd:x.Subtract},{t:["ws","lf"],cmd:x.Multiply},{t:["tab","ws"],cmd:x.Divide},{t:["tab","tab"],cmd:x.Modulo},{t:["lf"],cmd:x.KaladeshArithmetic}])}findHeapCommand(e){return this.findCommandAndParam(e,[{t:["ws"],cmd:x.Store},{t:["tab"],cmd:x.Retrieve}])}findFlowCommand(e){let t=this.findCommandAndParam(e,[{t:["ws","ws"],cmd:x.Label},{t:["ws","tab"],cmd:x.Call},{t:["ws","lf"],cmd:x.Jump},{t:["tab","ws"],cmd:x.JumpIfZero},{t:["tab","tab"],cmd:x.JumpIfNegative},{t:["tab","lf"],cmd:x.Return},{t:["lf","lf"],cmd:x.End}]);return t}findIOCommand(e){return this.findCommandAndParam(e,[{t:["ws","ws"],cmd:x.OutputCharacter},{t:["ws","tab"],cmd:x.OutputNumber},{t:["tab","ws"],cmd:x.ReadCharacter},{t:["tab","tab"],cmd:x.ReadNumber}])}findCommandAndParam(e,t){let r=this.findCommand(e,t);if(r instanceof I)return r;if(void 0!=w.find(e=>e==r)){let n=this.findNumber(e);return n instanceof I?n:{command:r,param:n}}if(!k(r))return{command:r};{let a=this.findLabel(e);return a instanceof I?a:{command:r,param:a}}}findCommand(e,t){let r=[];r.push(e());let n=()=>t.find(e=>{let t=e.t;return void 0==r.find((e,r)=>t[r]!=e)}),a=n(),i=()=>t.find(e=>{let t=e.t;return t.length==r.length&&void 0==t.find((e,t)=>r[t]!=e)}),o=i();for(;void 0==o&&void 0!=a;)r.push(e()),a=n(),o=i();return void 0==o?j("There are no commands match to this pattern"):o.cmd}findNumber(e){let t=e();if("lf"==t)return j("Unexpected end of number");let r="ws"==t?1:-1;if("lf"==(t=e()))return j("Unexpected end of number");let n=[];for(n.push("ws"==t?0:1);"lf"!=(t=e());)n.push("ws"==t?0:1);return r*n.map((e,t)=>e<<n.length-1-t).reduce((e,t)=>e+t)}findLabel(e){let t=e(),r="";if("lf"==t)return j("Unexpected end of label");for(r+="ws"==t?"W":"tab"==t?"T":"L";"lf"!=(t=e());)r+="ws"==t?"W":"tab"==t?"T":"L";return r}}class v extends Error{constructor(){super()}}class I{constructor(e){this.msg=e}}function j(e){return new I(e)}class S{exec(e,t){let r=e.commands,n=e.labels,a=0,i=[],o=e=>{m(e),i.push(e)},d=()=>{if(0==i.length)throw Error("Attempt to pop from empty stack");return i.pop()},c=e=>{if(i.length<=e)throw Error("Index ".concat(e," element is not exsist on stack"));return i[e]},s=e=>{if(i.length<=e)throw Error("Index ".concat(e," element is not exsist on stack"));return i.splice(e,1)},l=new Map,m=e=>{if(!Number.isSafeInteger(e))throw Error("Integer overflowed")},u=e=>(m(e),l.has(e)?l[e]:0),h=(e,t)=>l.set(e,t),f=[],p=e=>{f.push(e)},b=()=>{if(0==f.length)throw Error("Attempt to end a subroutine in non-subrotine");return f.pop()};try{for(;r.length>a;){let x=r[a];switch(console.log(x.command),x.command){case"Push":o(x.param),a++;break;case"Dup":let w=d();o(w),o(w),a++;break;case"Copy":o(c(x.param)),a++;break;case"Swap":{let g=d(),k=d();o(g),o(k)}a++;break;case"Discard":d(),a++;break;case"Slide":s(x.param),a++;break;case"Add":{let C=d(),v=d();o(C+v)}a++;break;case"Subtract":{let I=d(),j=d();o(j-I)}a++;break;case"Multiply":{let S=d(),E=d();o(S*E)}a++;break;case"Divide":{let y=d(),A=d();o(Math.trunc(A/y))}a++;break;case"Modulo":{let Z=d(),N=d();o(N%Z)}a++;break;case"KaladeshArithmetic":throw Error("あなたのコンピューターは処理に耐えられませんでした。社長がお呼びです。");case"Store":{let R=d(),F=d();h(F,R)}a++;break;case"Retrieve":{let O=d();o(u(O))}a++;break;case"Label":case"ReadCharacter":case"ReadNumber":a++;break;case"Call":{p(a+1);let P=x.param,J=n.find(e=>e.label==P).commandIndex;if(void 0==J)throw Error("Cannot find label ".concat(P));a=J}break;case"Jump":{let D=x.param,M=n.find(e=>e.label==D).commandIndex;if(void 0==M)throw Error("Cannot find label ".concat(D));a=M}break;case"JumpIfZero":{let L=d();if(0==L){let _=x.param,T=n.find(e=>e.label==_).commandIndex;if(void 0==T)throw Error("Cannot find label ".concat(_));a=T}else a++}break;case"JumpIfNegative":{let H=d();if(H<0){let K=x.param,U=n.find(e=>e.label==K).commandIndex;if(void 0==U)throw Error("Cannot find label ".concat(K));a=U}else a++}break;case"Return":a=b();break;case"End":return;case"OutputCharacter":t(String.fromCodePoint(d())),a++;break;case"OutputNumber":t(d().toString()),a++}}}catch(W){W instanceof Error&&t("Error at index".concat(a," command: ").concat(W.message))}}}function E(){let[e,t]=m.useState("カラデシュ!\nすごい!\n本当にすごいんだ!"),[r,a]=m.useState(),[u,f]=m.useState(),[x,w]=m.useState();p().languages.kaladesh={ws:/すごい\!/,tab:/カラデシュ\!/,lf:/本当にすごいんだ\!/};let g=()=>{let t=new C,r=t.parse(e,"すごい!","カラデシュ!","本当にすごいんだ!",!0);a(r),void 0==r?f(""):f(function(e){if("commands"in e)return e.commands.map(e=>"  ".concat(e.command," ").concat("param"in e?e.param.toString():"","\n")).reduce((e,t)=>e+t,"");if(!("error"in e))return e.map(e=>"Syntax Error:".concat(e.msg," Token Index=").concat(e.tokenIndex,"\n")).reduce((e,t)=>e+t,"");{let t=e.error.map(e=>"Syntax Error: ".concat(e.msg,", Command Index=").concat(e.commandIndex,"\n")).reduce((e,t)=>e+t,"");return e.out.length>0&&(t+="\n・Commands to refer\n"+e.out.map((e,t)=>t.toString()+": "+(void 0==e?"???\n":"".concat(e.command," ").concat("param"in e?e.param.toString():"","\n"))).reduce((e,t)=>e+t,"")),t}}(r))},k=()=>{if(void 0==r||Array.isArray(r)||"error"in r){w("");return}let e=new S,t="";e.exec(r,e=>t+=e),w(t)};return(0,n.jsxs)("div",{children:[(0,n.jsxs)(i(),{children:[(0,n.jsx)("title",{children:"カラデシュ言語エディター"}),(0,n.jsx)("meta",{name:"description",content:"カラデシュ言語すごい!本当にすごいんだ!"}),(0,n.jsx)("link",{rel:"icon",href:"/NextApp/favicon.ico"}),(0,n.jsx)("style",{children:"\n      .token.ws {\n        color: cornflowerblue;\n      }\n      .token.tab {\n        color: #DD4A68;\n      }\n      .token.lf {\n        color: coral;\n      }\n    "})]}),(0,n.jsxs)(o.Z,{container:!0,alignItems:"center",spacing:2,children:[(0,n.jsx)(o.Z,{item:!0,children:(0,n.jsx)("h1",{children:"カラデシュ言語エディター"})}),(0,n.jsx)(o.Z,{item:!0,children:(0,n.jsx)(d.Z,{href:"./help",children:(0,n.jsx)(c.Z,{variant:"contained",children:"Help (内容は保存されません!)"})})})]}),(0,n.jsx)("hr",{}),(0,n.jsxs)(o.Z,{container:!0,children:[(0,n.jsx)(o.Z,{item:!0,children:(0,n.jsxs)(s.Z,{children:[(0,n.jsx)("h3",{children:"コード"}),(0,n.jsx)("hr",{style:{marginRight:"15px"}}),(0,n.jsx)(h(),{value:e,onValueChange:e=>t(e),highlight:e=>p().highlight(e,p().languages.kaladesh,"kaladesh"),padding:10,style:{fontFamily:'"Fira code", "Fira Mono", monospace',fontSize:12,fontWeight:"bold"}})]})}),(0,n.jsx)(o.Z,{item:!0,children:(0,n.jsx)(l.Z,{onClick:g,children:(0,n.jsx)(b.Z,{})})}),void 0==u?(0,n.jsx)(n.Fragment,{}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(o.Z,{item:!0,children:(0,n.jsxs)(s.Z,{style:{whiteSpace:"pre"},children:[(0,n.jsx)("h3",{children:"コンパイル結果"}),(0,n.jsx)("hr",{style:{marginRight:"15px"}}),u]})}),(0,n.jsx)(o.Z,{item:!0,children:(0,n.jsx)(l.Z,{onClick:k,children:(0,n.jsx)(b.Z,{})})}),void 0==x?(0,n.jsx)(n.Fragment,{}):(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(o.Z,{item:!0,children:(0,n.jsxs)(s.Z,{style:{whiteSpace:"pre"},children:[(0,n.jsx)("h3",{children:"実行結果"}),(0,n.jsx)("hr",{style:{marginRight:"15px"}}),x]})})})]})]})]})}}},function(e){e.O(0,[24,158,632,460,711,774,888,179],function(){return e(e.s=3964)}),_N_E=e.O()}]);